
/**
 * name: Fantastic-admin
 * homepage: https://hooray.gitee.io/fantastic-admin/
 */
    
import{_ as t}from"./index.c1f75aed.js";import{x as i,y as e,o as n,z as s,H as o,r as h,i as a,w as c,A as l,J as d,I as r}from"./vendor.b5a7373b.js";import{_ as g}from"./index.29752973.js";const f={name:"SignCanvas",model:{value:"image",event:"confirm"},props:{image:{required:!1,type:[String],default:null},options:{required:!1,type:[Object],default:()=>null}},emits:["confirm"],data:()=>({value:null,domId:`sign-canvas-${Math.random().toString(36).substr(2)}`,canvas:null,context:null,dpr:1,config:{isFullScreen:!1,isFullCover:!1,isDpr:!1,lastWriteSpeed:1,lastWriteWidth:2,lineCap:"round",lineJoin:"round",canvasWidth:600,canvasHeight:600,isShowBorder:!0,bgColor:"#fcc",borderWidth:1,borderColor:"#ff787f",writeWidth:5,maxWriteWidth:30,minWriteWidth:5,writeColor:"#101010",isSign:!1,imgType:"png"},resizeTimer:null}),watch:{options:{handler(){this.init()},deep:!0}},mounted(){this.init(),window.addEventListener("resize",(()=>{this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((()=>{this.init()}),100)}))},methods:{init(){const t=this.options;if(t)for(const i in t)this.config[i]=t[i];this.dpr="undefined"!=typeof window&&this.config.isDpr&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio)||1,this.canvas=document.getElementById(this.domId),this.context=this.canvas.getContext("2d"),this.canvas.style.background=this.config.bgColor,this.config.isFullScreen&&(this.config.canvasWidth=window.innerWidth||document.body.clientWidth,this.config.canvasHeight=window.innerHeight||document.body.clientHeight,this.config.isFullCover&&(this.canvas.style.position="fixed",this.canvas.style.top=0,this.canvas.style.left=0,this.canvas.style.margin=0,this.canvas.style.zIndex=20001)),this.canvas.height=this.config.canvasWidth,this.canvas.width=this.config.canvasHeight,this.canvasInit(),this.canvasClear()},setLineWidth(){const t=(new Date).getTime(),i=t-this.config.lastWriteTime;this.config.lastWriteTime=t;let e=this.config.minWriteWidth+(this.config.maxWriteWidth-this.config.minWriteWidth)*i/30;if(e<this.config.minWriteWidth?e=this.config.minWriteWidth:e>this.config.maxWriteWidth&&(e=this.config.maxWriteWidth),e=e.toFixed(2),this.config.isSign)this.context.lineWidth=this.config.writeWidth*this.dpr;else{const t=this.config.lastWriteWidth=this.config.lastWriteWidth/4*3+e/4;this.context.lineWidth=t*this.dpr}},writeBegin(t){this.config.isWrite=!0,this.config.lastWriteTime=(new Date).getTime(),this.config.lastPoint=t,this.writeContextStyle()},writing(t){this.context.beginPath(),this.context.moveTo(this.config.lastPoint.x*this.dpr,this.config.lastPoint.y*this.dpr),this.context.lineTo(t.x*this.dpr,t.y*this.dpr),this.setLineWidth(),this.context.stroke(),this.config.lastPoint=t,this.context.closePath()},writeEnd(t){this.config.isWrite=!1,this.config.lastPoint=t,this.saveAsImg()},writeContextStyle(){this.context.beginPath(),this.context.strokeStyle=this.config.writeColor,this.context.lineCap=this.config.lineCap,this.context.lineJoin=this.config.lineJoin},canvasClear(){this.context.save(),this.context.strokeStyle=this.config.writeColor,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.lineWidth=this.config.borderWidth*this.dpr,this.context.strokeStyle=this.config.borderColor;let t=this.config.borderWidth/2*this.dpr;this.config.isShowBorder&&(this.context.moveTo(t,t),this.context.lineTo(this.canvas.width-t,t),this.context.lineTo(this.canvas.width-t,this.canvas.height-t),this.context.lineTo(t,this.canvas.height-t),this.context.closePath(),this.context.stroke()),this.config.isShowBorder&&!this.config.isSign&&(this.context.moveTo(0,0),this.context.lineTo(this.canvas.width,this.canvas.height),this.context.lineTo(this.canvas.width,this.canvas.height/2),this.context.lineTo(0,this.canvas.height/2),this.context.lineTo(0,this.canvas.height),this.context.lineTo(this.canvas.width,0),this.context.lineTo(this.canvas.width/2,0),this.context.lineTo(this.canvas.width/2,this.canvas.height),this.context.stroke()),this.$emit("confirm",null),this.context.restore()},saveAsImg(){const t=new Image;return t.src=this.canvas.toDataURL(`image/${this.config.imgType}`),this.$emit("confirm",t.src),t.src},canvasInit(){this.canvas.width=this.config.canvasWidth*this.dpr,this.canvas.height=this.config.canvasHeight*this.dpr,this.canvas.style.width=`${this.config.canvasWidth}px`,this.canvas.style.height=`${this.config.canvasHeight}px`,this.config.emptyCanvas=this.canvas.toDataURL(`image/${this.config.imgType}`)},handleMousedown(t){this.writeBegin({x:t.offsetX||t.clientX,y:t.offsetY||t.clientY})},handleMousemove(t){this.config.isWrite&&this.writing({x:t.offsetX,y:t.offsetY})},handleMouseup(t){this.writeEnd({x:t.offsetX,y:t.offsetY})},handleMouseleave(t){this.config.isWrite=!1,this.config.lastPoint={x:t.offsetX,y:t.offsetY}},handleTouchstart(t){const i=t.targetTouches[0],e=i.clientX?i.clientX-this.getRect().left:i.pageX-this.offset(i.target,"left"),n=i.clientY?i.clientY-this.getRect().top:i.pageY-this.offset(i.target,"top");this.writeBegin({x:e,y:n})},handleTouchmove(t){const i=t.targetTouches[0],e=i.clientX?i.clientX-this.getRect().left:i.pageX-this.offset(i.target,"left"),n=i.clientY?i.clientY-this.getRect().top:i.pageY-this.offset(i.target,"top");this.config.isWrite&&this.writing({x:e,y:n})},handleTouchend(t){const i=t.targetTouches,e=t.changedTouches,n=i&&i.length&&i[0]||e&&e.length&&e[0],s=n.clientX?n.clientX-this.getRect().left:n.pageX-this.offset(n.target,"left"),o=n.clientY?n.clientY-this.getRect().top:n.pageY-this.offset(n.target,"top");this.writeEnd({x:s,y:o})},downloadSignImg(t){const i=document.getElementById(this.domId).toDataURL("image/png");this.saveFile(i,t?`${t}.${this.config.imgType}`:`${Date.parse(new Date)}.${this.config.imgType}`)},saveFile(t,i){const e=document.createElementNS("http://www.w3.org/1999/xhtml","a");e.href=t,e.download=i;const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(n)},getRect(){return this.$refs[this.domId].getBoundingClientRect()},offset(t,i){const e="offset"+i[0].toUpperCase()+i.substring(1);let n=t[e],s=t.offsetParent;for(;null!=s;)n+=s[e],s=s.offsetParent;return n},dealImage(){var t=document.createElement("canvas"),i=t.getContext("2d");t.width=300,t.width=200;const e=document.getElementById(this.domId).toDataURL("image/png");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0,t.width,t.height);t.toDataURL("image/jpeg",.6)}}};i("data-v-58171d9b");const v=["id"];e(),f.render=function(t,i,e,h,a,c){return n(),s("canvas",{id:a.domId,ref:a.domId,class:"app-sign-canvas",onMousedown:i[0]||(i[0]=o(((...t)=>c.handleMousedown&&c.handleMousedown(...t)),["prevent","stop"])),onMousemove:i[1]||(i[1]=o(((...t)=>c.handleMousemove&&c.handleMousemove(...t)),["prevent","stop"])),onMouseup:i[2]||(i[2]=o(((...t)=>c.handleMouseup&&c.handleMouseup(...t)),["prevent","stop"])),onMouseleave:i[3]||(i[3]=o(((...t)=>c.handleMouseleave&&c.handleMouseleave(...t)),["prevent","stop"])),onTouchstart:i[4]||(i[4]=o(((...t)=>c.handleTouchstart&&c.handleTouchstart(...t)),["prevent","stop"])),onTouchmove:i[5]||(i[5]=o(((...t)=>c.handleTouchmove&&c.handleTouchmove(...t)),["prevent","stop"])),onTouchend:i[6]||(i[6]=o(((...t)=>c.handleTouchend&&c.handleTouchend(...t)),["prevent","stop"]))}," 您的浏览器不支持canvas技术,请升级浏览器! ",40,v)},f.__scopeId="data-v-58171d9b";const u={data:()=>({value:null,options:{isDpr:!0,lastWriteSpeed:1,lastWriteWidth:2,lineCap:"round",lineJoin:"bevel",canvasWidth:500,canvasHeight:250,isShowBorder:!1,bgColor:"#fee",borderWidth:1,borderColor:"#ff787f",writeWidth:5,maxWriteWidth:30,minWriteWidth:5,writeColor:"#101010",isSign:!0,imgType:"png"}}),methods:{canvasClear(){this.$refs.SignCanvas.canvasClear()},saveAsImg(){this.value=this.$refs.SignCanvas.saveAsImg()},downloadSignImg(){this.$refs.SignCanvas.downloadSignImg()},open(t){window.open(t,"top")}}},m=l("p",null,"SignCanvas 三方组件",-1),p=l("p",null,"该组件可用于电子合同签订等在线签名使用场景",-1),w=l("p",{style:{"margin-bottom":"0"}},"由于该组件官方暂未支持 Vue3 ，所以框架已将其源码拷贝至框架内，并做为全局组件使用，相关 API 参考原组件仓库说明",-1),x=r("组件仓库地址"),W=r("清除画板"),T=r("生成图片"),y=r("下载图片"),C=["src","width","height"];u.render=function(i,e,o,r,v,u){const S=h("el-button"),b=t,I=f,M=g;return n(),s("div",null,[a(b,{title:"电子签名"},{content:c((()=>[m,p,w])),default:c((()=>[a(S,{icon:"el-icon-link",onClick:e[0]||(e[0]=t=>u.open("https://github.com/langyuxiansheng/vue-sign-canvas"))},{default:c((()=>[x])),_:1})])),_:1}),a(M,null,{default:c((()=>[a(I,{ref:"SignCanvas",options:v.options},null,8,["options"]),l("div",null,[a(S,{onClick:u.canvasClear},{default:c((()=>[W])),_:1},8,["onClick"]),a(S,{onClick:u.saveAsImg},{default:c((()=>[T])),_:1},8,["onClick"]),a(S,{onClick:u.downloadSignImg},{default:c((()=>[y])),_:1},8,["onClick"])]),v.value?(n(),s("img",{key:0,src:v.value,width:v.options.canvasWidth,height:v.options.canvasHeight},null,8,C)):d("v-if",!0)])),_:1})])};export{u as default};
